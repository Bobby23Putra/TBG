#!/usr/bin/env python

import serial
import time
import sys
import os

#def crc(str):
#	x=0x2D1
#	val = (0xffff - (x % 0x10000)) + 1
#	return hex(val)[2:]


if os.path.exists(sys.argv[1]) :
        ser = serial.Serial(
                port=sys.argv[1],
                baudrate=9600,
                parity=serial.PARITY_NONE,
                stopbits=serial.STOPBITS_ONE,
                bytesize=serial.EIGHTBITS,
                timeout=0
        )
        ser.close()
        ser.open()
        data = ""
        prev = ""
#ser.write('\x7E\x32\x35\x30\x31\x34\x36\x39\x30\x30\x30\x30\x30\x46\x44\x41\x35\x0D') # number pack 1
#ser.write('\x7E\x32\x35\x30\x32\x34\x36\x39\x30\x30\x30\x30\x30\x46\x44\x41\x34\x0D') # number pack 2
#ser.write('\x7E\x32\x35\x30\x33\x34\x36\x39\x30\x30\x30\x30\x30\x46\x44\x41\x33\x0D') # number pack 3



	if sys.argv[2] == "1" :
		ser.write('\x7E\x32\x35\x30\x31\x34\x36\x34\x32\x45\x30\x30\x32\x30\x31\x46\x44\x33\x30\x0D') # battery 1
	elif sys.argv[2] == "2" :
		ser.write("\x7E\x32\x35\x30\x32\x34\x36\x34\x32\x45\x30\x30\x32\x30\x32\x46\x44\x32\x45\x0D") # battery 2
	elif sys.argv[2] == "3" :
		ser.write('\x7E\x32\x35\x30\x33\x34\x36\x34\x32\x45\x30\x30\x32\x30\x33\x46\x44\x32\x43\x0D') # battery 3
	elif sys.argv[2] == "4" :
		ser.write('\x7E\x32\x35\x30\x34\x34\x36\x34\x32\x45\x30\x30\x32\x30\x34\x46\x44\x32\x41\x0D') # battery 4
	elif sys.argv[2] == "5" :
		ser.write('\x7E\x32\x35\x30\x35\x34\x36\x34\x32\x45\x30\x30\x32\x30\x35\x46\x44\x32\x38\x0D') # battery 5
	elif sys.argv[2] == "6" :
		ser.write('\x7E\x32\x35\x30\x36\x34\x36\x34\x32\x45\x30\x30\x32\x30\x36\x46\x44\x32\x36\x0D') # battery 6
	elif sys.argv[2] == "7" :
		ser.write('\x7E\x32\x35\x30\x37\x34\x36\x34\x32\x45\x30\x30\x32\x30\x37\x46\x44\x32\x34\x0D') # battery 7
	elif sys.argv[2] == "8" :
		ser.write('\x7E\x32\x35\x30\x38\x34\x36\x34\x32\x45\x30\x30\x32\x30\x38\x46\x44\x32\x32\x0D') # battery 8
	elif sys.argv[2] == "9" :
		ser.write('\x7E\x32\x35\x30\x39\x34\x36\x34\x32\x45\x30\x30\x32\x30\x39\x46\x44\x32\x30\x0D') # battery 9
	elif sys.argv[2] == "10" :
		ser.write('\x7E\x32\x35\x30\x41\x34\x36\x34\x32\x45\x30\x30\x32\x30\x41\x46\x44\x31\x30\x0D') # battery 10
	elif sys.argv[2] == "11" :
		ser.write('\x7E\x32\x35\x30\x42\x34\x36\x34\x32\x45\x30\x30\x32\x30\x42\x46\x44\x30\x45\x0D') # battery 11
	elif sys.argv[2] == "12" :
		ser.write('\x7E\x32\x35\x30\x43\x34\x36\x34\x32\x45\x30\x30\x32\x30\x43\x46\x44\x30\x43\x0D') # battery 12
	elif sys.argv[2] == "13" :
		ser.write('\x7E\x32\x35\x30\x44\x34\x36\x34\x32\x45\x30\x30\x32\x30\x44\x46\x44\x30\x41\x0D') # battery 13
	elif sys.argv[2] == "14" :
		ser.write('\x7E\x32\x35\x30\x45\x34\x36\x34\x32\x45\x30\x30\x32\x30\x45\x46\x44\x30\x38\x0D') # battery 14
	elif sys.argv[2] == "15" :
		ser.write('\x7E\x32\x35\x30\x46\x34\x36\x34\x32\x45\x30\x30\x32\x30\x46\x46\x44\x30\x36\x0D') # battery 15
	else :
		print "0"
		ser.close()
		exit()
	
	while True:
		raw = str(ser.read(1))
		data+= raw
		if raw == "\r":
			tag='-'.join(x for x in data)
			print tag
			ser.close()
			break
	'''
	sr = ser.read(2048)
	tag='-'.join(x for x in sr)
	print tag
	ser.close()
	'''
		
else:
	print "0"
